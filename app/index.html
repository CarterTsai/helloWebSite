<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Web Site Testing</title>
</head>
<style media="screen">
    .container {
        display: flex;
        flex-flow: row wrap;
    }

    .wrapper > * {
      padding: 10px;
      flex: 1 100%;
    }

    header {
        flex: 1;
    }

    .content {
        flex: 1;
        flex-flow: row wrap;
    }

    .box {
      flex: 1 100%;
      width: 400px;  /* Or whatever */
      height: 400px; /* Or whatever */
      margin-bottom: 50px;
      margin-left: 10px;
      overflow: scroll;
      float: left;
    }

    .imgBox {
        overflow: scroll;
    }

</style>

<body>
    <script>
            // gloab variable
            var time = 20;
            $ = require('./script/jquery-2.1.4.min.js');
            $(document).ready(function(){
                $(".times").text(time);
            });

            var request = require("request");
            var cron = require('node-schedule');
            var moment = require('moment-timezone');
            var childProcess = require('child_process');
            var fs = require('fs')
            var path = require('path')
            var phantomjs = require('phantomjs');
            var jQuery = require('jquery');
            var datas = require('./script/datas.js');
            var $ = jQuery;
            var count = 0;
            var scheduleTime = +time+' * * * * *';

            var j = cron.scheduleJob(scheduleTime, function() {
                var i = 0;
                for (var i = 0; i < datas.length; i++) {
                    var childArgs = [
                       path.join(__dirname, 'capture.js'),
                       datas[i].url,
                       datas[i].imageName,
                       datas[i].name,
                       i
                     ]

                    childProcess.execFile(phantomjs.path, childArgs, function (err, stdout, stderr) {
                       var result = JSON.parse(stdout);
                       var content = $(".content");
                       var box = $("#box-"+result.index);
                       if(box.length < 1) {
                           content.append("<div class='box' id='box-"+ result.index +"'><label>"+
                                            result.name
                                          +"</label>"+
                                            "<div class='imgBox'>"+
                                                "<img src='./img/"+result.imageName+"'></img>"+
                                            "</div>" +
                                          "</div>");
                        } else {
                            var selectBox = box[0];
                            $(selectBox).children("label").text(result.name);
                            $(selectBox).children("div").children("img").attr("src", './img/'+result.imageName);
                        }
                    });
                }
            });
    </script>
    <div class="container wrapper">
        <header>
            <h3 class="title now"></3>
            <h5>Update Status during <span class="times"></span>second </h5>
            <label>Url</label>
            <input placeholder="Url"/>
            <label for="">Name</label>
            <input placeholder="Name">
            <button type="button">新增</button>
        </header>
        <div class="content"></div>
    </div>

</body>

</html>
